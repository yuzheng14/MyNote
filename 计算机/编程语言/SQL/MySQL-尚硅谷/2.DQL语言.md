# DQL语言

## 基础查询

### 语法

```mysql
SELECT 查询列表 FROM 表名;
```

### 特点

- 查询列表可以是表中的字段、常量值、表达式、函数
- 查询的结果是一个虚拟的表格

### 查询

#### 查询单个字段

```mysql
SELECT 字段 FROM 表名;
```

#### 查询多个字段

```mysql
SELECT 字段，字段... FROM 表名;
```

#### 查询表中所有字段

```mysql
SELECT * FROM 表名;
```

字段名可用着重号`包裹以区分

#### 查询常量值

```mysql
SELECT 100;
SELECT 'john';
```

```
+-----+
| 100 |
+-----+
| 100 |
+-----+
1 row in set (0.00 sec)
```

#### 查询表达式

```mysql
SELECT 100*98;
```

```
+--------+
| 100*98 |
+--------+
|   9800 |
+--------+
1 row in set (0.00 sec)
```

#### 查询函数

```mysql
SELECT VERSION();
```

```
+-----------+
| VERSION() |
+-----------+
| 8.0.20    |
+-----------+
1 row in set (0.00 sec)
```

### 起别名

#### AS关键字

```mysql
SELECT 98*100 AS 结果;
```

```
+------+
| 结果 |
+------+
| 9800 |
+------+
1 row in set (0.00 sec)
```

```mysql
SELECT last_name AS 姓, first_name AS 名 FROM employees;
```

```
+-------------+-------------+
| 姓          | 名          |
+-------------+-------------+
| K_ing       | Steven      |
| Kochhar     | Neena       |
| De Haan     | Lex         |
		   ......
| Errazuriz   | Alberto     |
| Higgins     | Shelley     |
| Gietz       | William     |
+-------------+-------------+
107 rows in set (0.00 sec)
```

#### 直接写别名

```mysql
SELECT last_name 姓, first_name 名 FROM employees;
```

```
+-------------+-------------+
| 姓          | 名          |
+-------------+-------------+
| K_ing       | Steven      |
| Kochhar     | Neena       |
| De Haan     | Lex         |
		   ......
| Errazuriz   | Alberto     |
| Higgins     | Shelley     |
| Gietz       | William     |
+-------------+-------------+
107 rows in set (0.00 sec)
```

#### 好处

- 便于理解
- 有重复字段的情况时可以及进行区分

### 去重

使用DISTINCT关键字

```mysql
SELECT DISTINCT department_id FROM employees;
```

```
+---------------+
| department_id |
+---------------+
|          NULL |
|            10 |
|            20 |
|            30 |
|            40 |
|            50 |
|            60 |
|            70 |
|            80 |
|            90 |
|           100 |
|           110 |
+---------------+
12 rows in set (0.00 sec)
```

### +号的作用

SQL中的+号只有运算符的作用

#### 两方都为数值类型

数值加法

```mysql
SELECT 100+98;
```

```
+--------+
| 100+98 |
+--------+
|    198 |
+--------+
1 row in set (0.00 sec)
```

#### 一方为字符型

尝试将字符型转换为数值型，转换成功则数值加法，失败则字符型转换为0

```mysql
SELECT '100'+98;
```

```
+----------+
| '100'+98 |
+----------+
|      198 |
+----------+
1 row in set (0.00 sec)
```

```mysql
SELECT 'john'+98;
```

```
+-----------+
| 'john'+98 |
+-----------+
|        98 |
+-----------+
1 row in set, 1 warning (0.00 sec)
```

#### 一方为null

### 拼接字符串

`concat(str1,str2,...)`函数

```mysql
SELECT CONCAT(first_name,'-',last_name) AS 姓名 FROM employees;
```

```
+-------------------+
| 姓名              |
+-------------------+
| Steven-K_ing      |
| Neena-Kochhar     |
| Lex-De Haan       |
		......
| Shelley-Higgins   |
| William-Gietz     |
+-------------------+
107 rows in set (0.00 sec)
```

若有null数据则返回null（同+号）

```mysql
SELECT CONCAT(commission_pct,",",employee_id) AS 结果 FROM employees;
```

```
+----------+
| 结果     |
+----------+
| NULL     |
| NULL     |
	......
| 0.25,161 |
| 0.25,162 |
| 0.15,163 |
| 0.10,164 |
| 0.10,165 |
	......
| NULL     |
| NULL     |
+----------+
107 rows in set (0.00 sec)
```

此时可使用`IFNULL(exper1,exper2)`函数

```mysql
SELECT CONCAT(IFNULL(commission_pct,0),",",employee_id) AS 结果 FROM employees;
```

```
+----------+
| 结果     |
+----------+
| 0.00,100 |
| 0.00,101 |
| 0.00,102 |
	......
| 0.30,148 |
| 0.20,149 |
| 0.30,150 |
| 0.25,151 |
	......
| 0.00,203 |
| 0.00,204 |
| 0.00,205 |
| 0.00,206 |
+----------+
107 rows in set (0.00 sec)
```

## 条件查询

### 语法

```mysql
SELECT 查询列表 FROM 表名 WHERE 筛选条件;
```

### 分类

#### 按条件表达式筛选

条件运算符：  >  <  =  <>(!=)  >=  <=  <=>

#### 按逻辑表达式查询

逻辑运算符：  and(&&)  or(||)  not(!)

#### 模糊查询

- like
- between and
- in 
- is null/is not null

##### 特点

一般和通配符搭配使用

| 通配符 | 意义         |
| ------ | ------------ |
| %      | 任意多个字符 |
| _      | 任意单个字符 |

匹配通配符可用`\`转义，或者通过`ESCAPE`关键字转义，如`LIKE '_$_%' ESCAPE '$'`

### 演示

#### 条件运算符

```mysql
SELECT first_name,department_id FROM employees WHERE department_id<>90 ORDER BY department_id;
```

```
+-------------+---------------+
| first_name  | department_id |
+-------------+---------------+
| Jennifer    |            10 |
| Michael     |            20 |
| Pat         |            20 |
| Den         |            30 |
			......
| Ismael      |           100 |
| Jose Manuel |           100 |
| Luis        |           100 |
| Shelley     |           110 |
| William     |           110 |
+-------------+---------------+
103 rows in set (0.00 sec)
```

#### 逻辑运算符

```mysql
SELECT employee_id,first_name,salary FROM employees WHERE salary>=10000 AND salary<=20000;
```

```
+-------------+------------+----------+
| employee_id | first_name | salary   |
+-------------+------------+----------+
|         101 | Neena      | 17000.00 |
|         102 | Lex        | 17000.00 |
|         108 | Nancy      | 12000.00 |
|         114 | Den        | 11000.00 |
|         145 | John       | 14000.00 |
|         146 | Karen      | 13500.00 |
|         147 | Alberto    | 12000.00 |
|         148 | Gerald     | 11000.00 |
|         149 | Eleni      | 10500.00 |
|         150 | Peter      | 10000.00 |
|         156 | Janette    | 10000.00 |
|         162 | Clara      | 10500.00 |
|         168 | Lisa       | 11500.00 |
|         169 | Harrison   | 10000.00 |
|         174 | Ellen      | 11000.00 |
|         201 | Michael    | 13000.00 |
|         204 | Hermann    | 10000.00 |
|         205 | Shelley    | 12000.00 |
+-------------+------------+----------+
18 rows in set (0.00 sec)
```

#### 模糊查询

##### LIKE

```mysql
SELECT employee_id,first_name FROM employees WHERE first_name LIKE '%a%';
```

```
+-------------+-------------+
| employee_id | first_name  |
+-------------+-------------+
|         101 | Neena       |
|         103 | Alexander   |
|         105 | David       |
			......
|         202 | Pat         |
|         203 | Susan       |
|         204 | Hermann     |
|         206 | William     |
+-------------+-------------+
70 rows in set (0.00 sec)
```

```mysql
SELECT employee_id,first_name,salary FROM employees WHERE first_name LIKE '__e_a%';
```

```
+-------------+------------+----------+
| employee_id | first_name | salary   |
+-------------+------------+----------+
|         101 | Neena      | 17000.00 |
|         103 | Alexander  |  9000.00 |
|         115 | Alexander  |  3100.00 |
+-------------+------------+----------+
3 rows in set (0.00 sec)
```

```mysql
SELECT employee_id,first_name,last_name,salary FROM employees WHERE last_name LIKE '_\_%';
```

或者

```mysql
SELECT employee_id,first_name,last_name,salary FROM employees WHERE last_name LIKE '_$_%' ESCAPE '$';
```

```
+-------------+------------+-----------+----------+
| employee_id | first_name | last_name | salary   |
+-------------+------------+-----------+----------+
|         100 | Steven     | K_ing     | 24000.00 |
|         156 | Janette    | K_ing     | 10000.00 |
+-------------+------------+-----------+----------+
2 rows in set (0.00 sec)
```

##### BETWEEN AND

```mysql
SELECT employee_id,first_name,last_name,salary FROM employees WHERE employee_id BETWEEN 100 AND 120;
```

```
+-------------+-------------+------------+----------+
| employee_id | first_name  | last_name  | salary   |
+-------------+-------------+------------+----------+
|         100 | Steven      | K_ing      | 24000.00 |
|         101 | Neena       | Kochhar    | 17000.00 |
						......
|         119 | Karen       | Colmenares |  2500.00 |
|         120 | Matthew     | Weiss      |  8000.00 |
+-------------+-------------+------------+----------+
21 rows in set (0.00 sec)
```

##### IN

```mysql
SELECT employee_id,first_name,last_name,job_id FROM employees WHERE job_id IN('IT_PROG','AD_VP','AD_PRES');
```

```
+-------------+------------+-----------+---------+
| employee_id | first_name | last_name | job_id  |
+-------------+------------+-----------+---------+
|         100 | Steven     | K_ing     | AD_PRES |
|         101 | Neena      | Kochhar   | AD_VP   |
|         102 | Lex        | De Haan   | AD_VP   |
|         103 | Alexander  | Hunold    | IT_PROG |
|         104 | Bruce      | Ernst     | IT_PROG |
|         105 | David      | Austin    | IT_PROG |
|         106 | Valli      | Pataballa | IT_PROG |
|         107 | Diana      | Lorentz   | IT_PROG |
+-------------+------------+-----------+---------+
8 rows in set (0.00 sec)
```

##### IS NULL/IS NOT NULL

```mysql
SELECT employee_id,first_name,last_name,commission_pct FROM employees WHERE commission_pct IS NULL;
```

```
+-------------+-------------+-------------+----------------+
| employee_id | first_name  | last_name   | commission_pct |
+-------------+-------------+-------------+----------------+
|         100 | Steven      | K_ing       |           NULL |
|         101 | Neena       | Kochhar     |           NULL |
						......
|         205 | Shelley     | Higgins     |           NULL |
|         206 | William     | Gietz       |           NULL |
+-------------+-------------+-------------+----------------+
72 rows in set (0.00 sec)
```

```mysql
SELECT employee_id,first_name,last_name,commission_pct FROM employees WHERE commission_pct IS NOT NULL;
```

```
+-------------+-------------+------------+----------------+
| employee_id | first_name  | last_name  | commission_pct |
+-------------+-------------+------------+----------------+
|         145 | John        | Russell    |           0.40 |
|         146 | Karen       | Partners   |           0.30 |
						......
|         178 | Kimberely   | Grant      |           0.15 |
|         179 | Charles     | Johnson    |           0.10 |
+-------------+-------------+------------+----------------+
35 rows in set (0.00 sec)
```

#### 安全等于

```mysql
SELECT employee_id,first_name,last_name,commission_pct FROM employees WHERE commission_pct <=> NULL;
```

```
+-------------+-------------+-------------+----------------+
| employee_id | first_name  | last_name   | commission_pct |
+-------------+-------------+-------------+----------------+
|         100 | Steven      | K_ing       |           NULL |
|         101 | Neena       | Kochhar     |           NULL |
						......
|         206 | William     | Gietz       |           NULL |
+-------------+-------------+-------------+----------------+
72 rows in set (0.00 sec)
```

## 排序查询

### 语法

```mysql
SELECT 字段 FROM 表名 (WHERE 筛选条件) ORDER BY 排序字段 (ASC/DESC);
```

`ASC`为升序，`DESC`为降序，默认为升序

### 演示

```mysql
SELECT employee_id,first_name,last_name,hiredate FROM employees WHERE department_id>=90 ORDER BY hiredate;
```

```
+-------------+-------------+-----------+---------------------+
| employee_id | first_name  | last_name | hiredate            |
+-------------+-------------+-----------+---------------------+
|         100 | Steven      | K_ing     | 1992-04-03 00:00:00 |
|         101 | Neena       | Kochhar   | 1992-04-03 00:00:00 |
|         102 | Lex         | De Haan   | 1992-04-03 00:00:00 |
|         108 | Nancy       | Greenberg | 1998-03-03 00:00:00 |
|         109 | Daniel      | Faviet    | 1998-03-03 00:00:00 |
|         110 | John        | Chen      | 2000-09-09 00:00:00 |
|         111 | Ismael      | Sciarra   | 2000-09-09 00:00:00 |
|         112 | Jose Manuel | Urman     | 2000-09-09 00:00:00 |
|         113 | Luis        | Popp      | 2000-09-09 00:00:00 |
|         205 | Shelley     | Higgins   | 2016-03-03 00:00:00 |
|         206 | William     | Gietz     | 2016-03-03 00:00:00 |
+-------------+-------------+-----------+---------------------+
11 rows in set (0.00 sec)
```

```mysql
SELECT employee_id,first_name,last_name,salary*12*(1+IFNULL(commission_pct,0)) AS 'annual salary' FROM employees ORDER BY salary*12*(1+IFNULL(commission_pct,0));
```

```
+-------------+-------------+-------------+---------------+
| employee_id | first_name  | last_name   | annual salary |
+-------------+-------------+-------------+---------------+
|         132 | TJ          | Olson       |      25200.00 |
|         128 | Steven      | Markle      |      26400.00 |
						......
|         145 | John        | Russell     |     235200.00 |
|         100 | Steven      | K_ing       |     288000.00 |
+-------------+-------------+-------------+---------------+
107 rows in set (0.00 sec)
```

```mysql
SELECT employee_id,first_name,last_name,salary*12*(1+IFNULL(commission_pct,0)) AS 'annual salary' FROM employees ORDER BY `annual salary`;
```

```
+-------------+-------------+-------------+---------------+
| employee_id | first_name  | last_name   | annual salary |
+-------------+-------------+-------------+---------------+
|         132 | TJ          | Olson       |      25200.00 |
|         128 | Steven      | Markle      |      26400.00 |
						......
|         145 | John        | Russell     |     235200.00 |
|         100 | Steven      | K_ing       |     288000.00 |
+-------------+-------------+-------------+---------------+
107 rows in set (0.00 sec)
```

此处使用单引号包裹不生效

```mysql
SELECT employee_id,first_name,last_name,LENGTH(first_name) AS 名字长度 FROM employees ORDER BY 名字长度;
```

```
+-------------+-------------+-------------+----------+
| employee_id | first_name  | last_name   | 名字长度  |
+-------------+-------------+-------------+----------+
|         132 | TJ          | Olson       |        2 |
|         135 | Ki          | Gee         |        2 |
						......
|         153 | Christopher | Olsen       |       11 |
+-------------+-------------+-------------+----------+
107 rows in set (0.00 sec)
```

```mysql
SELECT employee_id,first_name,last_name,salary FROM employees ORDER BY salary ASC,employee_id DESC;
```

```
+-------------+-------------+-------------+----------+
| employee_id | first_name  | last_name   | salary   |
+-------------+-------------+-------------+----------+
|         132 | TJ          | Olson       |  2100.00 |
|         136 | Hazel       | Philtanker  |  2200.00 |
						......
|         100 | Steven      | K_ing       | 24000.00 |
+-------------+-------------+-------------+----------+
107 rows in set (0.00 sec)
```

## 常用函数

### 单行函数

#### 字符函数

##### length

LENGTH(str)，用于获取字符串字节长度，如utf-8下一个汉字的长度为3

##### concat

CONCAT(str1,str2,...)，用于拼接字符串

##### upper

UPPER(str)，将字母转换为大写

##### lower

LOWER(str)，将字母转换为小写

##### substr/substring

- SUBSTR/SUBSTRING(str FROM pos FOR len)
- SUBSTR/SUBSTRING(str FROM pos)
- SUBSTR/SUBSTRING(str,pos)
- SUBSTR/SUBSTRING(str,pos,len)

截取字符串

#### 数学函数

#### 日期函数

#### 其他函数（补充）

#### 流程控制函数（补充）

### 多行函数

统计函数、聚合函数